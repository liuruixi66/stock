# 股票量化分析系统 - 前后端适配指南

## 系统概述

本系统是一个完整的股票量化分析系统，包含：
- **后端**: Django REST API，提供数据接口和回测功能
- **前端**: Vue 3 + TypeScript + Vite，提供用户界面

## 系统架构

```
股票量化分析系统
├── 前端 (Vue 3 + TypeScript)
│   ├── 端口: 3000
│   ├── 框架: Vite + Vue 3 + TypeScript
│   └── UI库: Bootstrap + Element Plus
├── 后端 (Django REST API)
│   ├── 端口: 8002
│   ├── 框架: Django 4.2+ 
│   └── 数据库: MySQL
└── 反向代理
    └── Vite Dev Server (开发环境)
```

## 快速启动

### 1. 环境准备

确保系统已安装：
- Python 3.8+
- Node.js 16+
- MySQL 5.7+

### 2. 一键启动

```bash
# 给启动脚本执行权限
chmod +x start_system.sh

# 启动全部服务
./start_system.sh all

# 或者分别启动
./start_system.sh backend   # 仅启动后端
./start_system.sh frontend  # 仅启动前端
```

### 3. 数据库初始化

```bash
# 初始化数据库和示例数据
python init_database.py
```

### 4. 访问系统

- **前端界面**: http://localhost:3000
- **后端API**: http://localhost:8002/api/
- **管理后台**: http://localhost:8002/admin/
  - 用户名: admin
  - 密码: admin123

## 手动部署

### 后端部署

1. **环境准备**
```bash
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

2. **数据库配置**
```bash
# 创建数据库
mysql -u root -p
CREATE DATABASE stockdb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

3. **Django配置**
```bash
cd myproject
python manage.py makemigrations
python manage.py migrate
python manage.py createsuperuser
```

4. **启动服务**
```bash
python manage.py runserver 0.0.0.0:8002
```

### 前端部署

1. **安装依赖**
```bash
cd frontend
npm install
```

2. **开发模式**
```bash
npm run dev
```

3. **生产构建**
```bash
npm run build
```

## API接口列表

### 股票数据接口

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/stock-spot/` | GET | 获取股票现货数据 |
| `/api/stock-fund-flow/` | GET | 获取股票资金流向 |
| `/api/stock-bonus/` | GET | 获取股票分红配送 |
| `/api/stock-top/` | GET | 获取股票龙虎榜 |
| `/api/stock-blocktrade/` | GET | 获取股票大宗交易 |
| `/api/industry-fund-flow/` | GET | 获取行业资金流向 |
| `/api/concept-fund-flow/` | GET | 获取概念资金流向 |
| `/api/etf-spot/` | GET | 获取ETF现货数据 |
| `/api/stock-realtime/` | GET | 获取实时股票数据 |
| `/api/filter_stocks/` | POST | 股票筛选 |

### 技术指标接口

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/calculate-macd/` | POST | 计算MACD指标 |
| `/api/market/ma/` | GET | 获取移动平均线 |
| `/api/market/kdj/` | POST | 计算KDJ指标 |

### 回测接口

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/backtest/run/` | POST | 运行回测 |
| `/api/backtest/config/` | GET | 获取回测配置 |

## 前端组件说明

### 主要页面
- `Index.vue` - 首页
- `StockSpot.vue` - 股票现货数据
- `StockFundFlow.vue` - 资金流向分析
- `TechnicalIndicatorDisplay.vue` - 技术指标展示
- `BacktestDetails.vue` - 回测详情

### API调用示例

```typescript
import { stockApi, indicatorApi, backtestApi } from '@/api/stock'

// 获取股票数据
const stockData = await stockApi.getStockSpot({
    date: '2024-01-01',
    code: '000001'
})

// 计算技术指标
const macdData = await indicatorApi.calculateMacd({
    code: '000001',
    period: 20
})

// 运行回测
const backtestResult = await backtestApi.runBacktest({
    strategy: 'ma_crossover',
    start_date: '2023-01-01',
    end_date: '2023-12-31'
})
```

## 配置说明

### 环境变量

**后端 (.env)**
```env
DEBUG=True
DB_NAME=stockdb
DB_USER=root
DB_PASSWORD=your_password
CORS_ALLOW_ALL_ORIGINS=True
```

**前端 (.env.development)**
```env
VITE_API_BASE_URL=http://localhost:8002/api
VITE_APP_TITLE=股票量化分析系统
```

### 数据库配置

```python
# backend/myproject/settings.py
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'stockdb',
        'USER': 'root',
        'PASSWORD': '9',
        'HOST': 'localhost',
        'PORT': '3306',
    }
}
```

### CORS配置

```python
# backend/myproject/settings.py
CORS_ALLOW_ALL_ORIGINS = True
CORS_ALLOW_METHODS = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS']
```

## 开发工具

### 启动脚本命令

```bash
./start_system.sh all       # 启动全部服务
./start_system.sh backend   # 仅启动后端
./start_system.sh frontend  # 仅启动前端
./start_system.sh stop      # 停止所有服务
./start_system.sh status    # 查看服务状态
./start_system.sh restart   # 重启所有服务
```

### 日志查看

```bash
# 查看Django日志
tail -f backend/myproject/django.log

# 查看前端开发服务器日志
# 在启动前端时会在终端显示
```

## 故障排除

### 常见问题

1. **端口冲突**
   - 后端默认端口8002，前端默认端口3000
   - 可以在相应配置文件中修改

2. **数据库连接失败**
   - 检查MySQL服务是否启动
   - 确认数据库用户名密码正确
   - 确保数据库stockdb已创建

3. **CORS错误**
   - 确认后端CORS配置正确
   - 检查前端API请求地址

4. **依赖安装失败**
   - Python依赖: `pip install -r requirements.txt`
   - Node.js依赖: `npm install`

### 调试技巧

1. **API调试**
   ```bash
   # 测试API健康状况
   curl http://localhost:8002/api/health/
   ```

2. **前端调试**
   - 使用浏览器开发者工具
   - 查看Network标签页API请求

3. **后端调试**
   - 查看Django DEBUG信息
   - 使用Django管理后台查看数据

## 生产部署

### 后端生产配置

1. **设置环境变量**
```bash
export DEBUG=False
export ALLOWED_HOSTS=your-domain.com
```

2. **收集静态文件**
```bash
python manage.py collectstatic
```

3. **使用Gunicorn**
```bash
pip install gunicorn
gunicorn myproject.wsgi:application --bind 0.0.0.0:8002
```

### 前端生产部署

1. **构建生产版本**
```bash
npm run build
```

2. **使用Nginx部署**
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        root /path/to/frontend/dist;
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://localhost:8002;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## 更新日志

### v1.0.0 (2024-01-01)
- 完成前后端基础架构
- 实现股票数据API
- 添加技术指标计算
- 完成回测系统集成
- 创建启动脚本和部署指南
